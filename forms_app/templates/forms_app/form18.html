<!-- templates/forms_app/form18.html -->
{% extends "forms_app/base_form.html" %}
{% block title %}–§–æ—Ä–º–∞ 18: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é{% endblock %}

{% block content %}
<h2>üí∞ –§–æ—Ä–º–∞ 18: –§–æ—Ä–º–∞ 2 —Å —Ä–∞–∑–Ω–æ–π —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é</h2>

<!-- === –ß–∞—Å—Ç—å 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—á—ë—Ç–∞ === -->
<div class="card mb-4">
  <div class="card-header bg-success text-white">
    <i class="fas fa-file-excel"></i> –ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ—Ç—á—ë—Ç Wildberries (.xlsx)
  </div>
  <br/>
  <div class="card-body">
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="report_file">–§–∞–π–ª –æ—Ç—á—ë—Ç–∞:</label>
          <input type="file" name="report_file" id="report_file" accept=".xlsx,.xls" required class="form-control">
        </div>
        <br/>
      </div>
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="sebestoimost">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (‚ÇΩ):</label>
          <input type="number" name="sebestoimost" id="sebestoimost" value="600" min="0" step="10"
                 class="form-control">
          <small class="form-text text-muted">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –∞—Ä—Ç–∏–∫—É–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ –Ω–∏–∂–µ</small>
        </div>
        <br/>
        <div class="col-md-6">
          <label for="nalog_procent">–ù–∞–ª–æ–≥ (%):</label>
          <input type="number" name="nalog_procent" id="nalog_procent" value="7" min="0" max="100" step="0.1"
                 class="form-control">
          <small class="form-text text-muted">–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞–ª–æ–≥–∞ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä–∏–±—ã–ª–∏</small>
        </div>
      </div>
      <br/>
      <button type="submit" name="action" value="process_report" class="btn btn-success">
        <i class="fas fa-calculator"></i> –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª
      </button>
    </form>
  </div>
</div>
<br/>
<!-- === –ß–∞—Å—Ç—å 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—è–º–∏ (CRUD) === -->
<div class="card">
  <div class="card-header bg-primary text-white">
    <i class="fas fa-edit"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é –∞—Ä—Ç–∏–∫—É–ª–æ–≤
  </div>
  <br/>
  <div class="card-body">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div class="card mb-4">
      <div class="card-header bg-light">
        <i class="fas fa-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞—Ä—Ç–∏–∫—É–ª
      </div>
      <br/>
      <div class="card-body">
        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="action" value="add_article">

          <div class="mb-3">
            <label for="{{ form.wb_article.id_for_label }}">WB –∞—Ä—Ç–∏–∫—É–ª:</label>
            {{ form.wb_article }}
            <small class="form-text text-muted">–£–Ω–∏–∫–∞–ª—å–Ω—ã–π —á–∏—Å–ª–æ–≤–æ–π –∞—Ä—Ç–∏–∫—É–ª Wildberries</small>
          </div>
          <br/>

          <div class="mb-3">
            <label for="{{ form.seller_article.id_for_label }}">–ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
            {{ form.seller_article }}
            <small class="form-text text-muted">–í–∞—à –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞—Ä—Ç–∏–∫—É–ª </small>
          </div>
          <br/>

          <div class="mb-3">
            <label for="{{ form.cost.id_for_label }}">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ 1 —à—Ç (‚ÇΩ):</label>
            {{ form.cost }}
            <small class="form-text text-muted">–°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —ç—Ç–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞</small>
          </div>
          <br/>

          <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä—Ç–∏–∫—É–ª</button>
        </form>
      </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π -->
    {% if records %}
      <h4 class="mt-4">–í–∞—à–∏ –∞—Ä—Ç–∏–∫—É–ª—ã ({{ records.count }})</h4>
      <table class="table table-hover table-bordered">
        <thead class="table-dark">
          <tr>
            <th>WB –∞—Ä—Ç–∏–∫—É–ª</th>
            <th>–ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞</th>
            <th>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å, ‚ÇΩ</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% for r in records %}
            <tr>
              <td><code>{{ r.wb_article }}</code></td>
              <td>{{ r.seller_article|default:"‚Äî" }}</td>
              <td>{{ r.cost }}</td>
              <td>
                <a href="{% url 'forms_app:form18_edit' r.pk %}" class="btn btn-sm btn-outline-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                  <i class="fas fa-edit"></i>
                </a>
                <a href="{% url 'forms_app:form18_delete' r.pk %}" 
                   class="btn btn-sm btn-outline-danger"
                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –¥–ª—è –∞—Ä—Ç–∏–∫—É–ª–∞ {{ r.wb_article }}?')"
                   title="–£–¥–∞–ª–∏—Ç—å">
                  <i class="fas fa-trash"></i>
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="alert alert-info">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∞—Ä—Ç–∏–∫—É–ª–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</div>
    {% endif %}
  </div>
</div>

{% endblock %}