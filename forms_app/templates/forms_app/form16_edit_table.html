<!-- templates/forms_app/form16_edit_table.html -->
{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h3 class="mb-0">
                <i class="fas fa-edit"></i> Таблица артикулов Формы 16
            </h3>
            <a href="{% url 'forms_app:form16_main' %}" class="btn btn-light btn-sm">
                <i class="fas fa-arrow-left"></i> Назад
            </a>
        </div>
        
        <div class="card-body">
            <form method="post" id="articlesForm">
                {% csrf_token %}
                
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th width="5%">#</th>
                                <th width="20%">Артикул WB</th>
                                <th width="20%">Наш артикул</th>
                                <th width="35%">Комментарии</th>
                                <th width="10%">Активен</th>
                                <th width="10%">Статус</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in table_data %}
                            <tr>
                                <td class="text-center">
                                    <strong>{{ item.position }}</strong>
                                </td>
                                <td>
                                    <input type="text" 
                                           name="article_{{ item.position }}" 
                                           value="{{ item.article_wb }}"
                                           class="form-control form-control-sm"
                                           placeholder="Артикул WB">
                                </td>
                                <td>
                                    <input type="text" 
                                           name="our_article_{{ item.position }}" 
                                           value="{{ item.our_article }}"
                                           class="form-control form-control-sm"
                                           placeholder="Наш артикул">
                                </td>
                                <td>
                                    <textarea 
                                           name="comments_{{ item.position }}" 
                                           class="form-control form-control-sm"
                                           rows="2"
                                           placeholder="Комментарии...">{{ item.comments }}</textarea>
                                </td>
                                <td class="text-center">
                                    <div class="form-check d-flex justify-content-center">
                                        <input type="checkbox" 
                                               name="active_{{ item.position }}" 
                                               {% if item.is_active %}checked{% endif %}
                                               class="form-check-input"
                                               id="active_{{ item.position }}">
                                    </div>
                                </td>
                                <td class="text-center">
                                    {% if item.exists %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-check"></i> Сохранен
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">
                                            <i class="fas fa-times"></i> Не заполнен
                                        </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-4 d-flex justify-content-between">
                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="fas fa-save"></i> Сохранить таблицу
                    </button>
                    
                    <div>
                        <a href="{% url 'forms_app:form16_delete_all' %}" class="btn btn-danger">
                            <i class="fas fa-trash-alt"></i> Удалить все
                        </a>
                        <a href="{% url 'forms_app:form16_main' %}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Отмена
                        </a>
                    </div>
                </div>
            </form>
            
            <div class="alert alert-info mt-4">
                <h5><i class="fas fa-lightbulb"></i> Советы:</h5>
                <ul class="mb-0">
                    <li><strong>Артикул WB</strong> - артикул на Wildberries</li>
                    <li><strong>Наш артикул</strong> - наше внутреннее название товара</li>
                    <li><strong>Комментарии</strong> - любые заметки по артикулу (поставщик, особенности и т.д.)</li>
                    <li>Только артикулы с галочкой "Активен" попадут в отчет</li>
                    <li>Чтобы удалить артикул - очистите поле "Артикул WB" и сохраните</li>
                </ul>
            </div>
            
            {% if messages %}
            <div class="mt-3">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .form-control-sm {
        font-size: 0.875rem;
    }
    textarea.form-control-sm {
        min-height: 60px;
        resize: vertical;
    }
    .form-check-input {
        transform: scale(1.2);
        margin-top: 0;
    }
    .badge {
        font-size: 0.8rem;
        padding: 0.3em 0.6em;
    }
    th {
        font-size: 0.9rem;
        vertical-align: middle;
    }
    td {
        vertical-align: middle;
    }
    .table td, .table th {
        padding: 0.5rem;
    }
</style>
{% endblock %}