<!-- templates/forms_app/form4_chart.html -->
{% extends "forms_app/base_form.html" %} {% block title %}–ì—Ä–∞—Ñ–∏–∫:
{{code}}{%endblock%} {% block content %}
<h2>
  üìà –ì—Ä–∞—Ñ–∏–∫ ‚Äî {{ code }} |
  <span style="font-size: 0.9em; color: #555">{{ article|default:"‚Äî" }}</span> |
  {{ label }}
</h2>

{% if dates %}
<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—ã—Å–æ—Ç–æ–π -->
<div style="height: 400px; position: relative; margin: 20px 0">
  <canvas id="chartCanvas"></canvas>
</div>

<!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div
  style="
    background: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
  "
>
  <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π:</strong> {{ dates|length }}</p>
  <p><strong>–î–∞—Ç—ã:</strong> {{ dates|safe }}</p>
  <p><strong>–î–∞–Ω–Ω—ã–µ:</strong> {{ data|safe }}</p>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –≥—Ä–∞—Ñ–∏–∫–∞ -->
<div style="margin-bottom: 20px">
  <a
    href="{% url 'forms_app:form4_chart' code=code %}"
    class="btn {% if chart_type == 'profit' %}active{% endif %}"
    >üìà –ü—Ä–∏–±—ã–ª—å</a
  >
  <a
    href="{% url 'forms_app:form4_chart_type' code=code chart_type='sales' %}"
    class="btn {% if chart_type == 'sales' %}active{% endif %}"
    >üí∞ –ü—Ä–æ–¥–∞–∂–∏</a
  >
  <a
    href="{% url 'forms_app:form4_chart_type' code=code chart_type='orders' %}"
    class="btn {% if chart_type == 'orders' %}active{% endif %}"
    >üì¶ –ó–∞–∫–∞–∑—ã</a
  >
  <a
    href="{% url 'forms_app:form4_chart_type' code=code chart_type='percent' %}"
    class="btn {% if chart_type == 'percent' %}active{% endif %}"
    >% –í—ã–∫—É–ø–∞</a
  >
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // –ñ–¥—ë–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.addEventListener('DOMContentLoaded', function() {
      const ctx = document.getElementById('chartCanvas').getContext('2d');

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ
      const labels = {{ dates|safe }};
      const chartData = {{ data|safe }};

      // –°–æ–∑–¥–∞—ë–º –≥—Ä–∞—Ñ–∏–∫
      new Chart(ctx, {
          type: 'line',
          data: {
              labels: labels,
              datasets: [{
                  label: '{{ label }}',
                  data: chartData,
                  borderColor: '{{ color }}',
                  backgroundColor: '{{ color }}'.replace(')', ', 0.1)'),
                  borderWidth: 2,
                  tension: 0,  // –ü—Ä—è–º—ã–µ –ª–∏–Ω–∏–∏
                  fill: true
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,  // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!
              plugins: {
                  legend: {
                      position: 'top',
                  },
                  tooltip: {
                      mode: 'index',
                      intersect: false
                  }
              },
              scales: {
                  y: {
                      beginAtZero: false,
                      ticks: {
                          callback: function(value) {
                              // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                              if ('{{ label }}' === '% –í—ã–∫—É–ø–∞') {
                                  return value + '%';
                              } else if ('{{ label }}' === '–ó–∞–∫–∞–∑—ã') {
                                  return value;
                              } else {
                                  return value.toLocaleString() + ' ‚ÇΩ';
                              }
                          }
                      }
                  }
              }
          }
      });
  });
</script>

<div style="margin-top: 30px">
  <a href="{% url 'forms_app:form4_detail' code=code %}" class="btn"
    >‚Üê –ù–∞–∑–∞–¥ –∫ –¥–∞–Ω–Ω—ã–º</a
  >
  <a href="{% url 'forms_app:form4_list' %}" class="btn">üìã –í—Å–µ –∞—Ä—Ç–∏–∫—É–ª—ã</a>
</div>
{% else %}
<p style="color: #888; font-style: italic">
  üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞.
</p>
<a href="{% url 'forms_app:form4_detail' code=code %}" class="btn">‚Üê –ù–∞–∑–∞–¥</a>
{% endif %} {% endblock %}
