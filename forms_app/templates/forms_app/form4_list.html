<!-- templates/forms_app/form4_list.html -->
{% extends "forms_app/base_form.html" %} 
{% block title %}–§–æ—Ä–º–∞ 4: –í—Å–µ –∞—Ä—Ç–∏–∫—É–ª—ã{% endblock %} 
{% block content %}
<h2>üìã –í—Å–µ –∫–æ–¥—ã –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã</h2>
<p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–¥, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–¥–∞–∂ –∏ –ø—Ä–∏–±—ã–ª–∏.</p>

<!-- –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ -->
<div style="margin-bottom: 20px">
  <input
    type="text"
    id="searchInput"
    placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É –∏–ª–∏ –∫–æ–¥—É..."
    style="
      padding: 10px;
      font-size: 16px;
      width: 100%;
      max-width: 500px;
      border: 1px solid #ccc;
      border-radius: 6px;
    "
  />
</div>

{% if codes_with_articles %}
<!-- –ë–ª–æ–∫ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π -->
<div
  style="
    max-height: 500px;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    background-color: #fff;
    margin: 20px 0;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  "
>
  <ul id="codesList" style="list-style: none; padding: 0; margin: 0">
    {% for item in codes_with_articles %}
    <li
      style="margin: 8px 0"
      data-article="{{ item.article|lower }} {{ item.code }}"
    >
      <a
        href="{% url 'forms_app:form4_detail' code=item.code %}"
        class="btn"
        style="width: 100%; text-align: center"
      >
        {{ item.code }} ‚Äî {{ item.article|default:"‚Äî" }}
      </a>
    </li>
    {% endfor %}
  </ul>

  <!-- –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ -->
  <div
    id="noResults"
    style="color: #888; text-align: center; display: none; padding: 10px"
  >
    –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
  </div>
</div>
{% else %}
<p style="color: #888; font-style: italic">
  üìÑ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.
  <a href="{% url 'forms_app:form4_upload' %}">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª</a>, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.
</p>
{% endif %}

<!-- –ë–ª–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–∞—Ç–µ -->
<div
  style="
    margin-top: 40px;
    padding: 15px;
    border: 1px solid #ffc107;
    border-radius: 8px;
    background-color: #fff3cd;
  "
>
  <h3 style="color: #856404">üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–∞—Ç–µ</h3>
  
  <form method="post" action="{% url 'forms_app:form4_clear_by_date' %}" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É?')">
    {% csrf_token %}
    
    <div style="margin-bottom: 15px;">
      <label for="date" style="display: block; margin-bottom: 8px; font-weight: bold;">
        –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:
      </label>
      <select 
        name="date" 
        id="date" 
        style="
          width: 100%;
          max-width: 300px;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 6px;
          font-size: 16px;
        "
        required
      >
        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É --</option>
        {% for date in available_dates %}
        <option value="{{ date }}">{{ date }}</option>
        {% endfor %}
      </select>
      <div style="color: #666; font-size: 14px; margin-top: 5px;">
        –ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ –≤—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –ø–æ –≤—Å–µ–º –∞—Ä—Ç–∏–∫—É–ª–∞–º.
      </div>
    </div>
    
    <button 
      type="submit" 
      class="btn"
      style="background-color: #ffc107; color: #212529; border-color: #ffc107;"
      {% if not available_dates %}disabled{% endif %}
    >
      üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
    </button>
  </form>
</div>

<!-- –ë–ª–æ–∫ –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö -->
<div
  style="
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #dc3545;
    border-radius: 8px;
    background-color: #f8d7da;
  "
>
  <h3 style="color: #721c24">‚ö†Ô∏è –û–ø–∞—Å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è</h3>
  <p>
    –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã 4 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    <strong>{{ request.user.username }}</strong>?
  </p>
  <a
    href="{% url 'forms_app:form4_clear' %}"
    class="btn"
    style="background-color: #dc3545; color: white;"
    onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã 4? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')"
  >
    üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
  </a>
</div>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
<div style="margin-top: 30px">
  <a href="{% url 'forms_app:form4_upload' %}" class="btn"
    >‚ûï –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</a
  >
  <a href="{% url 'forms_app:form4_export' %}" class="btn"
    >‚¨áÔ∏è –í—ã–≥—Ä—É–∑–∏—Ç—å –≤—Å—ë –≤ Excel</a
  >
  <a href="{% url 'home:home' %}" class="btn" style="background-color: #6c757d"
    >‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a
  >
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("searchInput");
    const codesList = document.getElementById("codesList");
    const items = codesList ? codesList.getElementsByTagName("li") : [];
    const noResults = document.getElementById("noResults");

    if (searchInput && items.length > 0) {
      searchInput.addEventListener("input", function () {
        const query = searchInput.value.toLowerCase().trim();
        let visibleCount = 0;

        Array.from(items).forEach((item) => {
          const text = item.dataset.article;
          if (text.includes(query)) {
            item.style.display = "";
            visibleCount++;
          } else {
            item.style.display = "none";
          }
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
        if (query && visibleCount === 0) {
          noResults.style.display = "block";
        } else {
          noResults.style.display = "none";
        }
      });
    }

    // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const dateSelect = document.getElementById('date');
    if (dateSelect && dateSelect.options.length > 1) {
      // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –ø–æ—Å–ª–µ "-- –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É --"
      dateSelect.selectedIndex = 1;
    }
  });
</script>
{% endblock %}