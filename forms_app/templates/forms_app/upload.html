<!-- templates/forms_app/upload.html -->
{% extends "forms_app/base_form.html" %}
{% block title %}–§–æ—Ä–º–∞ 4: –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞{% endblock %}

{% block content %}
    <h2>üìÅ –§–æ—Ä–º–∞ 4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ –§–æ—Ä–º—ã 2, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –∞—Ä—Ç–∏–∫—É–ª–∞–º</h2>

    {% if error %}
        <p style="color: red;">{{ error }}</p>
    {% endif %}

<form method="post" enctype="multipart/form-data" id="uploadForm">
    {% csrf_token %}

    <!-- –ü–æ–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ -->
    <label for="file">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª:</label>
    <br><br>
    <input type="file" id="file" name="file" accept=".xlsx,.xls" required>
    <br><br>

    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>
</form>

<!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div id="loading" style="display:none; margin-top: 20px;">
    <p>‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.</p>
</div>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById('uploadForm');
        const loading = document.getElementById('loading');

        if (form && loading) {
            form.addEventListener('submit', function (e) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                loading.style.display = 'block';

                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                // e.preventDefault();
                // setTimeout(() => form.submit(), 1500); // —ç–º—É–ª—è—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏
            });
        }
    });
</script>
    

    <!-- –ë–ª–æ–∫ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    {% if user.is_authenticated %}
        <div style="margin-top: 30px;">
            <h3>üì¶ –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:</h3>

            <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ -->
           <a href="{% url 'forms_app:download_output_file' %}" class="btn">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª</a>
            <br><br>

            <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é -->
            <a href="{% url 'home:home' %}" class="btn">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    {% endif %}
{% endblock %}