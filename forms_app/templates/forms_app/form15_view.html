{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0">
                <i class="fas fa-cut"></i> –§–æ—Ä–º–∞ 15: –†–∞—Å—á–µ—Ç —Ä–∞—Å–∫—Ä–æ—è —Ç–∫–∞–Ω–∏
            </h2>
        </div>
        
        <div class="card-body">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="alert alert-info mb-4">
                <h3><i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h3>
                <p class="mb-0">
                    –î–æ–±–∞–≤—å—Ç–µ –ª–µ–∫–∞–ª–∞ (–¥–µ—Ç–∞–ª–∏ –∫—Ä–æ—è), —É–∫–∞–∂–∏—Ç–µ —à–∏—Ä–∏–Ω—É —Ç–∫–∞–Ω–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤.
                    –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF —Ñ–∞–π–ª —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π.
                </p>
            </div>
            
            <div class="row">
                <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –õ–µ–∫–∞–ª–∞ -->
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                            <h3 class="mb-0">üìè –õ–µ–∫–∞–ª–∞</h3>
                            <span class="badge bg-secondary">{{ patterns_count }} –¥–µ—Ç–∞–ª–µ–π –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ</span>
                        </div>
                        <div class="card-body">
                            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–µ–∫–∞–ª–∞ -->
                            <form method="post" class="mb-4">
                                {% csrf_token %}
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        {{ pattern_form.name.label_tag }}
                                        {{ pattern_form.name }}
                                    </div>
                                    <div class="col-md-4">
                                        {{ pattern_form.width.label_tag }}
                                        {{ pattern_form.width }}
                                    </div>
                                    <div class="col-md-4">
                                        {{ pattern_form.height.label_tag }}
                                        {{ pattern_form.height }}
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button type="submit" name="add_pattern" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞–ª–æ
                                    </button>
                                    
                                    <!-- –ö–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ Excel -->
                                    <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#importModal">
                                        <i class="fas fa-file-import"></i> –ò–º–ø–æ—Ä—Ç –∏–∑ Excel
                                    </button>
                                </div>
                            </form>
                            
                            <!-- –°–ø–∏—Å–æ–∫ –ª–µ–∫–∞–ª -->
                            {% if patterns %}
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                            <th>–®–∏—Ä–∏–Ω–∞ (–º–º)</th>
                                            <th>–í—ã—Å–æ—Ç–∞ (–º–º)</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for pattern in patterns %}
                                        <tr>
                                            <td>{{ pattern.name }}</td>
                                            <td>{{ pattern.width }}</td>
                                            <td>{{ pattern.height }}</td>
                                            <td>
                                                <a href="{% url 'forms_app:form15_edit_pattern' pattern.pk %}" 
                                                   class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{% url 'forms_app:form15_delete_pattern' pattern.pk %}" 
                                                   class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-ruler-combined fa-3x text-muted mb-3"></i>
                                <p class="text-muted">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ª–µ–∫–∞–ª</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å–∫—Ä–æ—è -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h3 class="mb-0">‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å–∫—Ä–æ—è</h3>
                        </div>
                        <div class="card-body">
                            <!-- ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω action –∫ —Ñ–æ—Ä–º–µ —Ä–∞—Å—á–µ—Ç–∞ -->
                            <form method="post" action="{% url 'forms_app:form15_calculate' %}">
                                {% csrf_token %}
                                
                                <!-- –®–∏—Ä–∏–Ω–∞ —Ç–∫–∞–Ω–∏ -->
                                <div class="mb-3">
                                    {{ cutting_form.fabric_width.label_tag }}
                                    {{ cutting_form.fabric_width }}
                                    <small class="text-muted">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —Ä—É–ª–æ–Ω–Ω–æ–π —Ç–∫–∞–Ω–∏: 1500 –º–º</small>
                                </div>
                                
                                <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤ -->
                                <div class="mb-3">
                                    {{ cutting_form.num_sets.label_tag }}
                                    {{ cutting_form.num_sets }}
                                </div>
                                
                                <!-- –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ -->
                                <div class="mb-4">
                                    <label class="form-label">{{ cutting_form.output_format.label }}</label>
                                    <div>
                                        {% for radio in cutting_form.output_format %}
                                        <div class="form-check">
                                            {{ radio.tag }}
                                            <label class="form-check-label" for="{{ radio.id_for_label }}">
                                                {{ radio.choice_label }}
                                            </label>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                
                                <!-- –ö–Ω–æ–ø–∫–∏ -->
                                <div class="d-grid gap-2">
                                    <button type="submit" name="calculate" class="btn btn-success btn-lg">
                                        <i class="fas fa-calculator"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å
                                    </button>
                                    
                                    
                                    {% if patterns_count > 0 %}
                                    <a href="{% url 'forms_app:form15_clear_all' %}" class="btn btn-outline-danger">
                                        <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–µ–∫–∞–ª–∞
                                    </a>
                                    {% endif %}
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
                    <div class="card mt-4">
                        <div class="card-body">
                            <h3><i class="fas fa-lightbulb"></i> –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</h3>
                            <ol class="mb-0">
                                <li>–î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –ª–µ–∫–∞–ª–∞ (–¥–µ—Ç–∞–ª–∏ –∫—Ä–æ—è) —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏</li>
                                <li>–£–∫–∞–∂–∏—Ç–µ —à–∏—Ä–∏–Ω—É —Ç–∫–∞–Ω–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ 1500 –º–º)</li>
                                <li>–ó–∞–¥–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤</li>
                                <li>–ù–∞–∂–º–∏—Ç–µ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å"</li>
                                <li>–°–∫–∞—á–∞–π—Ç–µ PDF —Ñ–∞–π–ª —Å —Ä–∞—Å–∫–ª–∞–¥–∫–æ–π</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ Excel -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-import"></i> –ò–º–ø–æ—Ä—Ç –ª–µ–∫–∞–ª –∏–∑ Excel
                </h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'forms_app:form15_import_excel' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ Excel —Ñ–∞–π–ª:</label>
                        <input type="file" name="excel_file" class="form-control" accept=".xlsx,.xls" required>
                    </div>
                    <div class="alert alert-info">
                        <small>
                            <i class="fas fa-info-circle"></i> –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏:
                            <code>–∏–º—è</code>, <code>—à–∏—Ä–∏–Ω–∞</code>, <code>–≤—ã—Å–æ—Ç–∞</code>
                        </small>
                    </div>
                    <div class="text-center">
                        <a href="{% static 'templates/—à–∞–±–ª–æ–Ω_–ª–µ–∫–∞–ª.xlsx' %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω
                        </a>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.table th {
    font-size: 0.85rem;
    font-weight: 600;
}
.table td {
    font-size: 0.9rem;
}
.btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}
.form-check {
    display: inline-block;
    margin-right: 20px;
}
.btn-success {
    background-color: #28a745;
    border-color: #28a745;
}
.btn-success:hover {
    background-color: #218838;
    border-color: #1e7e34;
}
</style>

{% endblock %}